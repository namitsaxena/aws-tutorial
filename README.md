## AWS CLI 
#### Configuration
* aws configure
* aws configure list
* aws configure get region

#### Current user
* aws sts get-caller-identity --output text 
* `aws sts get-caller-identity --output text --query Arn`

#### S3
* aws s3api list-buckets
* `aws s3api list-buckets --query "Buckets[].Name"`

#### EC2
* Create a key pair: The command below will create a keypair, and the private key will be displayed/saved locally in PEM format (the public key will be in AWS)
  * `aws ec2 create-key-pair --key-name admin_key_pair --query 'KeyMaterial' --output text > admin_key_pair.pem`
    * aws ec2 create-key-pair --key-name admin_key_pair ([reference](https://docs.aws.amazon.com/cli/latest/reference/ec2/create-key-pair.html))
  * aws ec2 describe-key-pairs --key-name admin_key_pair
  * To retrieve the public key 
    * chmod 400 admin_key_pair
    * ssh-keygen -y -f admin_key_pair.pem 
  * `aws ec2 delete-key-pair --key-name admin_key_pair`
  * [Amazon EC2 Key Pairs - Amazon Elastic Compute Cloud](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html#having-ec2-create-your-key-pair)
  * Keypair cannot be generated by cloud formation. It needs to be created in AWS or uploaded otherwise 
    * [Deploying private key pairs with AWS CloudFormation](https://binx.io/blog/2017/10/25/deploying-private-key-pairs-with-aws-cloudformation/)
* To launch an EC2 instance
  * Find an AMI type from console (or by running  a query) - ideally from free tier
    * `aws ec2 describe-images --owner amazon --filter "Name=architecture,Values=x86_64" "Name=description,Values=*Amazon Linux*2018.03*" "Name=image-type,Values=machine" "Name=virtualization-type,Values=hvm"`
  * Launch
    * `aws ec2 run-instances --image-id ami-035be7bafff33b6b6 --count 1 --instance-type t2.micro`
      * IF InvalidAMIID.NotFound) when calling the RunInstances operation: The image id '[ami-0b500ef59d8335eee]' does not exist
        * Most common cause is using image from a different region (make sure you are logged in the same region as your CLI)
    * Created with default VPC, security groups. Can be verified using:
      *  awless list vpcs
      * awless list securitygroups (also see below)
      * awless list subnets (by default 6 are available)
  * Terminate
    * `aws ec2 terminate-instances --instance-ids i-02fa4edd843531814`



